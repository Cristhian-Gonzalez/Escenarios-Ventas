<!DOCTYPE html>
<html lang="es-PY">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacitaci√≥n: Comercial y Ventas</title>
    <style>
        :root {
            --color-primary: #005fba; /* Ajuste de color para diferenciar Cl√∫ster Comercial (Azul) del de Cobranzas (Verde) si se desea, o mantener verde. Mantendr√© el verde por consistencia con la plantilla original solicitada, pero puedes cambiarlo aqu√≠. Volver√© al verde original #8DB600 para respetar "Plantilla de C√≥digo Maestra" estricta */
            --color-primary: #8DB600;
            --color-primary-dark: #6a8a00;
            --color-text: #333333;
            --color-text-light: #666666;
            --color-background: #f9f9f9;
            --color-card: #ffffff;
            --color-border: #e0e0e0;
            --color-white: #ffffff;
            --color-header-inactive: #d3d3d3;
            --color-header-hover: #bfbfbf;
            --color-role-tag: #b5b5b5;
            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --border-radius: 8px;
            --transition-speed: 0.3s;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-family-base); background-color: var(--color-background); color: var(--color-text); line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; padding: var(--spacing-lg); }
        header { background-color: var(--color-card); padding: var(--spacing-lg); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); }
        .header-top { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: var(--spacing-md); }
        .title-block h1 { color: var(--color-primary-dark); font-size: 1.8rem; margin: 0; line-height: 1.1; }
        .title-block .subtitle { font-size: 1.5rem; color: var(--color-text); margin: 0; line-height: 1.2; font-weight: 600; }
        .version-info { font-size: 0.9rem; font-style: italic; color: var(--color-text-light); white-space: nowrap; margin-left: var(--spacing-md); }
        .controls { display: flex; flex-direction: column; gap: var(--spacing-md); }
        .search-wrapper, .anchor-nav { position: relative; }
        #search-input, #anchor-select { width: 100%; padding: 12px 12px 12px 40px; border: 1px solid var(--color-border); border-radius: var(--border-radius); font-size: 1rem; }
        .search-wrapper::before, .anchor-nav::before { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 1.2rem; opacity: 0.5; }
        .search-wrapper::before { content: 'üîç'; }
        .anchor-nav::before { content: '‚öì'; pointer-events: none; }
        #anchor-select { cursor: pointer; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23cccccc' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center;}
        #filters { display: flex; flex-wrap: wrap; gap: var(--spacing-sm); justify-content: center; }
        .filter-btn { background-color: #f0f0f0; color: var(--color-text-light); border: 1px solid var(--color-border); padding: var(--spacing-sm) var(--spacing-md); border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all var(--transition-speed); display: inline-flex; align-items: center; gap: var(--spacing-sm); }
        .filter-btn:hover { background-color: #cccccc; color: var(--color-text); }
        .filter-btn.active { background-color: var(--color-primary); color: var(--color-white); border-color: var(--color-primary-dark); font-weight: bold; }
        .icon { width: 18px; height: 18px; }
        .filter-btn.active .icon { filter: brightness(0) invert(1); }
        #scenarios-container { display: grid; gap: var(--spacing-md); }
        .scenario { background-color: var(--color-card); border: 1px solid var(--color-border); border-radius: var(--border-radius); overflow: hidden; }
        .scenario-header { padding: var(--spacing-md) var(--spacing-lg); cursor: pointer; display: flex; justify-content: space-between; align-items: center; gap: var(--spacing-md); transition: background-color var(--transition-speed); background-color: var(--color-header-inactive); }
        .scenario-header:hover { background-color: var(--color-header-hover); }
        .scenario-title { font-size: 1.1rem; font-weight: 600; flex-grow: 1; }
        .scenario-role { display: flex; align-items: center; gap: var(--spacing-sm); font-size: 0.9rem; color: var(--color-white); background-color: var(--color-role-tag); padding: 4px var(--spacing-sm); border-radius: 12px; white-space: nowrap; }
        .scenario-header::after { content: '‚ñº'; font-size: 0.8rem; transition: transform var(--transition-speed); color: var(--color-text-light); }
        .scenario.open > .scenario-header::after { transform: rotate(180deg); }
        .scenario-content { display: grid; grid-template-rows: 0fr; transition: grid-template-rows var(--transition-speed) ease-in-out; }
        .scenario.open > .scenario-content { grid-template-rows: 1fr; }
        .scenario-content-inner { overflow: hidden; padding: 0 var(--spacing-lg); }
        .scenario.open .scenario-content-inner { padding: var(--spacing-lg); border-top: 1px solid var(--color-border); }
        .situation { margin-bottom: var(--spacing-md); padding-left: var(--spacing-md); border-left: 3px solid var(--color-primary); }
        .situation h3, .solution h3 { font-size: 1rem; margin-bottom: var(--spacing-sm); color: var(--color-primary-dark); }
        .solution-toggle { background-color: var(--color-primary); color: var(--color-white); border: none; padding: 10px 15px; border-radius: var(--border-radius); cursor: pointer; font-size: 0.9rem; font-weight: bold; transition: background-color var(--transition-speed); margin-bottom: var(--spacing-md); }
        .solution-toggle:hover { background-color: var(--color-primary-dark); }
        .solution { background-color: rgba(141, 182, 0, 0.05); border: 1px solid rgba(141, 182, 0, 0.2); border-radius: var(--border-radius); padding: var(--spacing-md); }
        .solution ul { list-style-position: inside; padding-left: var(--spacing-sm); }
        .solution ul li { margin-bottom: var(--spacing-sm); }
        [hidden] { display: none !important; }
        .floating-actions { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: var(--spacing-md); z-index: 110; }
        .fab { background-color: var(--color-primary); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); display: grid; place-items: center; transition: opacity 0.3s, transform 0.3s; opacity: 0; transform: scale(0.8); pointer-events: none; }
        .fab.visible { opacity: 1; transform: scale(1); pointer-events: auto; }
        .fab:hover { background-color: var(--color-primary-dark); transform: scale(1.05); }
        @media (max-width: 600px) { .header-top { flex-direction: column; align-items: flex-start; } .scenario-header { flex-direction: column; align-items: flex-start; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div class="title-block">
                    <h1>Comercial & Ventas</h1>
                    <p class="subtitle">Manual de Entrenamiento</p>
                </div>
                <span class="version-info">PG-CO-02/03/04 Ver 01</span>
            </div>
            <div class="controls">
                <div class="search-wrapper"><input type="search" id="search-input" placeholder="Buscar por palabra clave..."></div>
                <div class="anchor-nav"><select id="anchor-select"></select></div>
                <div id="filters"></div>
            </div>
        </header>
        <main id="scenarios-container"></main>
    </div>
    <div class="floating-actions">
        <button id="close-all-btn" class="fab" title="Cerrar todos los escenarios"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg></button>
        <button id="back-to-top" class="fab" title="Volver arriba"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg></button>
    </div>
    <script>
    const scenarios = [
        {
            "id": 1,
            "title": "El Turista Apurado (R√©gimen de Turismo)",
            "roles": ["Asesor de Ventas"],
            "situation": "Un cliente brasile√±o quiere comprar insumos y pide 'Factura sin IVA' (Exenta) porque es extranjero. El vendedor carga el pedido r√°pido como 'Exenta' y lo manda a Caja. El sistema no lo deja facturar.",
            "solution": "Seg√∫n Paso 1.1.2, para art√≠culos RT a extranjeros, primero se debe solicitar la copia del documento de identidad y solicitar la habilitaci√≥n al Coordinador de TI. Sin esa 'luz verde' de TI, el sistema bloquea la operaci√≥n fiscal."
        },
        {
            "id": 2,
            "title": "El Cliente Nuevo y su Ubicaci√≥n",
            "roles": ["Asesor de Ventas"],
            "situation": "Se registra un cliente nuevo. El vendedor carga Nombre, RUC y Tel√©fono. En 'Direcci√≥n de Entrega' pone 'Asunci√≥n'. Guarda y genera el pedido.",
            "solution": "El Instructivo IT-IN-01 exige cargar la Geolocalizaci√≥n (Pin en Mapa) en la pesta√±a de Contactos/Direcciones. Sin el 'Pin', el chofer del delivery no tendr√° ruta en su App."
        },
        {
            "id": 3,
            "title": "El Cambio de Direcci√≥n a Medias",
            "roles": ["Asesor de Ventas"],
            "situation": "Un cliente llama: 'Me mud√©, actualicen mi direcci√≥n'. El vendedor entra a Ping, actualiza la direcci√≥n en el mapa y confirma el pedido. La factura sale con la direcci√≥n vieja.",
            "solution": "El PG-CO-04 es claro: 'Realiza los cambios en ambos sistemas'. Se debe actualizar la ficha en Inventiva (F9/F8) para la facturaci√≥n legal y en Ping para la log√≠stica."
        },
        {
            "id": 4,
            "title": "La Orden de Compra Fantasma",
            "roles": ["Asesor de Ventas"],
            "situation": "Cliente corporativo env√≠a un WhatsApp: 'Ya te envi√© la Orden de Compra por correo, procesame el pedido urgente que el cami√≥n est√° saliendo'. El vendedor carga el pedido para ganar tiempo.",
            "solution": "'Si el Cliente opera con orden de compra se debe contar primero con la misma para registrar el Pedido'. El documento f√≠sico (impreso) debe entregarse al Cajero para adjuntar a la factura final."
        },
        {
            "id": 5,
            "title": "Pago con Cheque Diferido (Sin L√≠nea)",
            "roles": ["Asesor de Ventas"],
            "situation": "Cliente nuevo quiere llevar insumos por 6.000.000 Gs. Paga con un cheque a 40 d√≠as. El vendedor acepta porque 'el cheque se ve bien'.",
            "solution": "Si no tiene l√≠nea de cr√©dito, aplica la escala de cheques adelantados de la Pol√≠tica. Para 6.000.000 Gs, el plazo m√°ximo es 45 d√≠as, PERO debe procederse seg√∫n PG-CC-01 (An√°lisis de Cr√©dito previo). El vendedor no puede aprobar esto solo."
        },
        {
            "id": 6,
            "title": "El √çtem Faltante",
            "roles": ["Encargado de Dep√≥sito"],
            "situation": "Llega un pedido de 10 √≠tems al dep√≥sito. El Encargado se da cuenta de que falta stock del √≠tem #4. Modifica el pedido a mano, tacha el √≠tem y le dice al Cajero 'Factur√° el resto'.",
            "solution": "El Encargado NO puede editar el pedido parcialmente para facturar. La norma dice: 'Si alguno no cuenta con existencia... entrega el Pedido original al Cajero para su anulaci√≥n' y solicita al Vendedor un nuevo pedido con lo disponible."
        },
        {
            "id": 7,
            "title": "La Firma del Delivery (Moto)",
            "roles": ["Delivery"],
            "situation": "El Delivery llega al cliente. Sale un empleado nuevo a recibir la mercader√≠a y firma la factura. El Delivery entrega y se va.",
            "solution": "El Delivery debe 'verificar que el firmante est√© autorizado consultando en la App Delivery el registro de firmas'. Si la firma no coincide con los autorizados en sistema, no debe entregar (o debe pedir autorizaci√≥n inmediata)."
        },
        {
            "id": 8,
            "title": "Encomienda con Flete Pagado",
            "roles": ["Encargado de Dep√≥sito"],
            "situation": "Se env√≠a un pedido al interior por transportadora. El cliente pag√≥ el flete en la factura de venta. El Encargado de Dep√≥sito lleva el paquete a la transportadora pero no tiene dinero para pagar el env√≠o all√°.",
            "solution": "Antes de salir, el Encargado debe solicitar los fondos seg√∫n PG-FI-02 Caja Chica al Cajero, bas√°ndose en la indicaci√≥n del pedido."
        },
        {
            "id": 9,
            "title": "Devoluci√≥n de Tinta Abierta",
            "roles": ["Asesor de Ventas"],
            "situation": "Cliente trae un frasco de tinta abierto. Dice que se equivoc√≥ de color al pedir. Quiere devolverlo. El vendedor, para no perder al cliente, le hace la Nota de Cr√©dito.",
            "solution": "La Pol√≠tica de Ventas establece expl√≠citamente: 'No se aceptan devoluciones de productos abiertos o personalizados'. Esta devoluci√≥n requiere autorizaci√≥n excepcional del Gerente Comercial T√©cnico, no del vendedor."
        },
        {
            "id": 10,
            "title": "El Chofer y la Carga M√≥vil",
            "roles": ["Encargado de Dep√≥sito", "Log√≠stica"],
            "situation": "En el Centro de Distribuci√≥n, el Encargado de Dep√≥sito carga el cami√≥n. El Chofer conf√≠a y se sube a la cabina. El Controller no est√°. Salen a repartir.",
            "solution": "El Controller es obligatorio. Debe 'verificar cada art√≠culo... y firmar en el campo correspondiente'. Sin esa firma, cualquier faltante ser√° responsabilidad directa del Encargado de Dep√≥sito y el Chofer."
        },
        {
            "id": 11,
            "title": "La Demo Improvisada",
            "roles": ["Asesor de Ventas"],
            "situation": "Un cliente importante llega de sorpresa: 'Quiero ver funcionar la CNC ahora mismo'. El vendedor corre a prender la m√°quina.",
            "solution": "Las demos requieren Programaci√≥n. El vendedor debe notificar por correo al Encargado de ATC (Atenci√≥n T√©cnica) para asignar un T√©cnico. Encender equipos complejos sin supervisi√≥n t√©cnica viola el protocolo."
        },
        {
            "id": 12,
            "title": "Facturando el Anticipo (C√≥digo Incorrecto)",
            "roles": ["Cajero/a"],
            "situation": "Cliente paga 5.000 USD de anticipo por una impresora. El Cajero factura usando el c√≥digo del producto 'IMPRESORA XYZ' con cantidad 0.5 o precio manual.",
            "solution": "Para anticipos se DEBE utilizar el art√≠culo gen√©rico 'PAGO TOTAL ANTES DE LA ENTREGA' o 'PAGO PARCIAL...'. No se debe facturar el √≠tem del inventario hasta la entrega real."
        },
        {
            "id": 13,
            "title": "El Doble IVA (La Trampa Final)",
            "roles": ["Cajero/a", "Log√≠stica"],
            "situation": "Se entrega la impresora. El cliente ya pag√≥ el anticipo hace un mes (facturado). El Cajero emite ahora la factura por el valor total de la m√°quina. El cliente recibe la factura y grita: '¬°Me est√°n cobrando impuestos dos veces!'.",
            "solution": "Antes o al momento de emitir la factura final, el Asistente de Log√≠stica debe emitir una Nota de Cr√©dito para anular fiscalmente la factura del anticipo. Solo as√≠ la factura final por el total es v√°lida y no duplica deuda/impuestos."
        },
        {
            "id": 14,
            "title": "Venta de Equipo a Cr√©dito (Sin Copia)",
            "roles": ["Asesor de Ventas"],
            "situation": "Vendedor cierra venta de un Plotter financiado. Env√≠a el correo de autorizaci√≥n al Gerente Comercial T√©cnico. El Gerente aprueba. El vendedor procede a facturar.",
            "solution": "En operaciones a cr√©dito, se debe copiar la autorizaci√≥n al Jefe de Cr√©ditos y Cobranzas en el correo. El Vendedor debe esperar el OK de Cr√©ditos (PG-CC-01) adem√°s del OK Comercial."
        },
        {
            "id": 15,
            "title": "Canje de Equipo Usado",
            "roles": ["Asesor de Ventas"],
            "situation": "Cliente quiere entregar su plotter viejo como parte de pago. El vendedor lo mira y dice: 'Te reconozco 1.000 USD', y lo anota en el pedido.",
            "solution": "Los canjes requieren obligatoriamente 'Revisi√≥n y tasaci√≥n del equipo por parte del Servicio T√©cnico'. El precio final del usado lo aprueba el Gerente Comercial T√©cnico basado en ese informe t√©cnico."
        },
        {
            "id": 16,
            "title": "Anulaci√≥n Fuera de Tiempo",
            "roles": ["Asesor de Ventas"],
            "situation": "Un pedido fue facturado por error hace 10 minutos. El vendedor entra a 'Preventas' e intenta darle click a 'Anular'. El sistema no le deja.",
            "solution": "El instructivo dice: 'Solo los pedidos con estado PENDIENTE pueden ser anulados'. Si ya est√° FACTURADO, el proceso de anulaci√≥n requiere Nota de Cr√©dito o anulaci√≥n de la factura por parte de Caja, no desde el m√≥dulo de Ventas."
        },
        {
            "id": 17,
            "title": "El Kude No Llega",
            "roles": ["Cajero/a"],
            "situation": "Se factura a un cliente. El cliente reclama que no le llega el correo con la factura electr√≥nica. El Cajero le dice: 'Ya sali√≥ de ac√°, revise su spam'.",
            "solution": "El cajero debe entrar a MI SET, buscar la factura y verificar el estado. Si dice 'Aprobado' pero no lleg√≥, debe usar la funci√≥n Acciones > Reenviar DE o imprimir el Kude (KuDE) f√≠sicamente/PDF en el momento."
        },
        {
            "id": 18,
            "title": "Anticipo sin Orden de Compra (Equipo)",
            "roles": ["Asesor de Ventas"],
            "situation": "Vamos a comprar un equipo espec√≠fico para un cliente (Importaci√≥n bajo pedido). El cliente quiere pagar el anticipo ya. El vendedor pide facturar el anticipo.",
            "solution": "'Si el equipo se debe adquirir, solicita la Orden de Compra al Cliente' antes de procesar cualquier pago o pedido interno de compra (PG-CM-04). Sin la OC del cliente, Matiz no dispara la compra internacional."
        },
        {
            "id": 19,
            "title": "La Promesa de Instalaci√≥n",
            "roles": ["Asesor de Ventas"],
            "situation": "El vendedor factura el equipo y le dice al cliente: 'Llevatelo nom√°s, ma√±ana va el t√©cnico a instalarte'.",
            "solution": "El proceso exige que el Asesor registre el pedido de facturaci√≥n 'Una vez recibida la confirmaci√≥n del agendamiento... por parte del Servicio T√©cnico'. No se factura ni entrega si ATC no ha confirmado fecha de instalaci√≥n."
        },
        {
            "id": 20,
            "title": "Descuento por Amiguismo",
            "roles": ["Asesor de Ventas"],
            "situation": "Vendedor quiere aplicar un 15% de descuento a un amigo. En el sistema Ping baja el precio manual y guarda el pedido.",
            "solution": "Cualquier descuento comercial fuera de lista requiere autorizaci√≥n seg√∫n la tabla de la Pol√≠tica. Si es una 'Promoci√≥n General' la aprueba el Gerente Comercial. Si es puntual, debe tener un correo de respaldo antes de modificar el precio en Ping."
        }
    ];

    document.addEventListener('DOMContentLoaded', () => {
        const scenariosContainer = document.getElementById('scenarios-container');
        const searchInput = document.getElementById('search-input');
        const filtersContainer = document.getElementById('filters');
        const anchorSelect = document.getElementById('anchor-select');
        const backToTopButton = document.getElementById('back-to-top');
        const closeAllButton = document.getElementById('close-all-btn');
        let activeFilter = 'Todos';
        const SESSION_STORAGE_KEY = 'openScenariosComercial';
        const icons = {
            "Asesor de Ventas": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>`,
            "Encargado de Dep√≥sito": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 8h-3V4H7v4H4c-1.1 0-2 .9-2 2v10h20V10c0-1.1-.9-2-2-2zM9 6h6v2H9V6zm11 12H4v-3h2v1h2v-1h8v1h2v-1h2v3zm-5-5H8v-2h8v2z"/></svg>`,
            "Cajero/a": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 18H5V8h14v10zM5 6a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2H5zm-1-2h16v2H4V4zm4 4h8v2H8V8zm0 3h8v2H8v-2z"/></svg>`,
            "Delivery": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2V8zM6 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zM18 11H3V6h11v5h4v0z"/></svg>`,
            "Log√≠stica": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 1c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zM6 1C3.24 1 1 3.24 1 6s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm12 6H6c-2.76 0-5 2.24-5 5v3h22v-3c0-2.76-2.24-5-5-5zm-12 6c0-1.66 1.34-3 3-3h10c1.66 0 3 1.34 3 3v1H6v-1z"/></svg>`,
        };
        const getIconForRole = (role) => icons[role] || '';
        const renderScenarios = (scenariosToRender) => {
            scenariosContainer.innerHTML = '';
            scenariosToRender.forEach(s => {
                const scenarioEl = document.createElement('article');
                scenarioEl.className = 'scenario';
                scenarioEl.dataset.id = s.id;
                scenarioEl.id = `escenario-${s.id}`;
                scenarioEl.innerHTML = `
                    <header class="scenario-header" role="button" aria-expanded="false"><h2 class="scenario-title">${s.id}: ${s.title}</h2><div class="roles-wrapper">${s.roles.map(r => `<span class="scenario-role">${getIconForRole(r)}${r}</span>`).join('')}</div></header>
                    <div class="scenario-content">
                        <div class="scenario-content-inner">
                            <div class="situation"><h3>Situaci√≥n</h3><p>${s.situation}</p></div>
                            <button class="solution-toggle" aria-expanded="false">Ver Soluci√≥n Recomendada</button>
                            <div class="solution" hidden><h3>Soluci√≥n Recomendada</h3><ul>${s.solution.split('\n').map(l => `<li>${l}</li>`).join('')}</ul></div>
                        </div>
                    </div>`;
                scenariosContainer.appendChild(scenarioEl);
            });
        };
        const renderFilters = () => {
            const allRoles = [...new Set(scenarios.flatMap(s => s.roles))];
            let filtersHtml = `<button class="filter-btn active" data-role="Todos">Todos</button>`;
            allRoles.sort().forEach(role => { filtersHtml += `<button class="filter-btn" data-role="${role}">${getIconForRole(role)}${role}</button>`; });
            filtersContainer.innerHTML = filtersHtml;
        };
        const renderAnchorNav = () => {
            anchorSelect.innerHTML = '<option value="">Saltar a un escenario...</option>';
            scenarios.forEach(s => { const o = document.createElement('option'); o.value = s.id; o.textContent = `${s.id}: ${s.title}`; anchorSelect.appendChild(o); });
        };
        const filterAndSearch = () => {
            const searchTerm = searchInput.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            let filtered = scenarios.filter(s => activeFilter === 'Todos' || s.roles.includes(activeFilter));
            if (searchTerm) {
                filtered = filtered.filter(s => Object.values(s).join(' ').toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(searchTerm));
            }
            renderScenarios(filtered);
            loadState();
        };
        const saveState = () => { sessionStorage.setItem(SESSION_STORAGE_KEY, JSON.stringify(Array.from(document.querySelectorAll('.scenario.open')).map(el => el.dataset.id))); };
        const loadState = () => { JSON.parse(sessionStorage.getItem(SESSION_STORAGE_KEY) || '[]').forEach(id => { const el = document.querySelector(`.scenario[data-id='${id}']`); if (el) { el.classList.add('open'); el.querySelector('.scenario-header').setAttribute('aria-expanded', 'true'); } }); };
        searchInput.addEventListener('input', filterAndSearch);
        filtersContainer.addEventListener('click', e => { if (e.target.closest('.filter-btn')) { filtersContainer.querySelector('.active').classList.remove('active'); e.target.closest('.filter-btn').classList.add('active'); activeFilter = e.target.closest('.filter-btn').dataset.role; filterAndSearch(); } });
        anchorSelect.addEventListener('change', e => { if (e.target.value) { const target = document.getElementById(`escenario-${e.target.value}`); if (target) { if (!target.classList.contains('open')) { target.querySelector('.scenario-header').click(); } target.scrollIntoView({ behavior: 'smooth', block: 'center' }); } e.target.selectedIndex = 0; } });
        closeAllButton.addEventListener('click', () => { document.querySelectorAll('.scenario.open').forEach(s => { s.classList.remove('open'); s.querySelector('.scenario-header').setAttribute('aria-expanded', 'false'); }); sessionStorage.removeItem(SESSION_STORAGE_KEY); });
        scenariosContainer.addEventListener('click', e => { const header = e.target.closest('.scenario-header'); if (header) { const s = header.parentElement; s.classList.toggle('open'); header.setAttribute('aria-expanded', s.classList.contains('open')); saveState(); } const solToggle = e.target.closest('.solution-toggle'); if (solToggle) { const solDiv = solToggle.nextElementSibling; const isExp = solToggle.getAttribute('aria-expanded') === 'true'; solToggle.setAttribute('aria-expanded', !isExp); solDiv.hidden = isExp; solToggle.textContent = isExp ? 'Ver Soluci√≥n' : 'Ocultar Soluci√≥n'; } });
        const checkScroll = () => { backToTopButton.classList.toggle('visible', document.documentElement.scrollTop > 100); closeAllButton.classList.toggle('visible', document.querySelector('.scenario.open') !== null); };
        window.addEventListener('scroll', checkScroll);
        scenariosContainer.addEventListener('click', () => setTimeout(checkScroll, 350));
        closeAllButton.addEventListener('click', () => setTimeout(checkScroll, 350));
        backToTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
        renderFilters(); renderAnchorNav(); renderScenarios(scenarios); loadState(); checkScroll();
    });
    </script>
</body>
</html>
